<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, height=1080">
    <title>TikHub - Gift Bubbles Overlay</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 1920px;
            height: 1080px;
            overflow: hidden;
            background: transparent;
            font-family: 'Arial', sans-serif;
        }

        .gift-bubble {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 240, 255, 0.95));
            border-radius: 50px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.8);
            animation: float-up 4s ease-out forwards;
            backdrop-filter: blur(10px);
        }

        .gift-bubble.mega {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.95), rgba(255, 165, 0, 0.95));
            font-size: 1.5em;
            padding: 20px 30px;
            box-shadow: 0 12px 48px rgba(255, 165, 0, 0.6);
        }

        .gift-image {
            width: 48px;
            height: 48px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .mega .gift-image {
            width: 64px;
            height: 64px;
        }

        .gift-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .username {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .mega .username {
            font-size: 22px;
        }

        .gift-name {
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }

        .mega .gift-name {
            font-size: 18px;
        }

        .gift-count {
            font-weight: bold;
            color: #ff4444;
            font-size: 18px;
        }

        .mega .gift-count {
            font-size: 24px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        @keyframes float-up {
            0% {
                bottom: -100px;
                opacity: 0;
                transform: translateX(0) scale(0.8) rotate(-5deg);
            }
            10% {
                opacity: 1;
                transform: translateX(0) scale(1) rotate(0deg);
            }
            90% {
                opacity: 1;
                transform: translateX(var(--drift)) scale(1) rotate(var(--rotate));
            }
            100% {
                bottom: 1100px;
                opacity: 0;
                transform: translateX(var(--drift)) scale(0.8) rotate(var(--rotate));
            }
        }

        #connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-family: monospace;
            z-index: 10000;
        }

        #connection-status.connected {
            background: rgba(0, 200, 0, 0.7);
        }

        #connection-status.disconnected {
            background: rgba(200, 0, 0, 0.7);
        }
    </style>
</head>
<body>
    <div id="connection-status">Connecting...</div>
    <div id="gift-container"></div>

    <script>
        // Configuration - CHANGE THIS TO YOUR RENDER.COM URL
        const OVERLAY_SERVER_URL = 'wss://your-overlay-server.onrender.com';
        const WS_PATH = '/ws/gift-bubbles';
        
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 10;
        
        const statusEl = document.getElementById('connection-status');
        const container = document.getElementById('gift-container');
        
        // Connect to WebSocket
        function connect() {
            try {
                ws = new WebSocket(OVERLAY_SERVER_URL + WS_PATH);
                
                ws.onopen = () => {
                    console.log('‚úÖ Connected to TikHub Overlay Server');
                    statusEl.textContent = 'Connected';
                    statusEl.className = 'connected';
                    reconnectAttempts = 0;
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        console.log('üì• Received:', data);
                        
                        if (data.type === 'gift') {
                            showGift(data.giftData);
                        } else if (data.type === 'tiktok-event' && data.event?.type === 'gift') {
                            showGift(data.event);
                        }
                    } catch (error) {
                        console.error('Error processing message:', error);
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    statusEl.textContent = 'Error';
                    statusEl.className = 'disconnected';
                };
                
                ws.onclose = () => {
                    console.log('‚ùå Disconnected from server');
                    statusEl.textContent = 'Disconnected';
                    statusEl.className = 'disconnected';
                    
                    // Reconnect logic
                    if (reconnectAttempts < maxReconnectAttempts) {
                        reconnectAttempts++;
                        const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
                        console.log(`Reconnecting in ${delay}ms (attempt ${reconnectAttempts}/${maxReconnectAttempts})`);
                        setTimeout(connect, delay);
                    }
                };
            } catch (error) {
                console.error('Failed to create WebSocket:', error);
            }
        }
        
        // Show gift bubble
        function showGift(giftData) {
            const bubble = document.createElement('div');
            bubble.className = 'gift-bubble';
            
            // Mega gift for high value
            const giftValue = giftData.diamondCount || giftData.coins || 0;
            if (giftValue >= 1000) {
                bubble.classList.add('mega');
            }
            
            // Random horizontal position
            const lanes = [300, 600, 900, 1200, 1500];
            const lane = lanes[Math.floor(Math.random() * lanes.length)];
            bubble.style.left = lane + 'px';
            
            // Random drift and rotation
            const drift = (Math.random() - 0.5) * 200;
            const rotate = (Math.random() - 0.5) * 20;
            bubble.style.setProperty('--drift', drift + 'px');
            bubble.style.setProperty('--rotate', rotate + 'deg');
            
            // Create content
            const repeatCount = giftData.repeatCount || 1;
            const username = giftData.uniqueId || giftData.username || 'Anonymous';
            const giftName = giftData.giftName || 'Gift';
            const giftImage = giftData.giftPictureUrl || giftData.image || '';
            
            bubble.innerHTML = `
                ${giftImage ? `<img src="${giftImage}" class="gift-image" alt="${giftName}">` : ''}
                <div class="gift-info">
                    <div class="username">${username}</div>
                    <div class="gift-name">${giftName}</div>
                    ${repeatCount > 1 ? `<div class="gift-count">x${repeatCount}</div>` : ''}
                </div>
            `;
            
            container.appendChild(bubble);
            
            // Remove after animation
            setTimeout(() => {
                bubble.remove();
            }, 4000);
        }
        
        // Auto-hide connection status after 5 seconds
        setTimeout(() => {
            if (statusEl.className === 'connected') {
                statusEl.style.opacity = '0.3';
            }
        }, 5000);
        
        // Initialize
        connect();
        
        // Test function (for debugging)
        window.testGift = () => {
            showGift({
                uniqueId: 'TestUser',
                giftName: 'Rose',
                repeatCount: 5,
                diamondCount: 100,
                giftPictureUrl: 'https://p16-webcast.tiktokcdn.com/img/maliva/webcast-va/eba3a9bb85c33e017f3648aa1d235f35~tplv-obj.image'
            });
        };
    </script>
</body>
</html>

