<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, height=1080">
    <title>TikHub - Song Request Overlay</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            width: 1920px; height: 1080px;
            overflow: hidden; background: transparent;
            font-family: 'Arial', sans-serif;
        }
        #now-playing {
            position: absolute; bottom: 100px; left: 50%;
            transform: translateX(-50%);
            width: 800px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(29, 185, 84, 0.3);
        }
        .now-playing-header {
            font-size: 18px; color: #1db954;
            font-weight: bold; margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .track-info {
            display: flex; align-items: center; gap: 20px;
        }
        .album-art {
            width: 80px; height: 80px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .track-details {
            flex: 1;
        }
        .track-name {
            font-size: 24px; font-weight: bold;
            color: white; margin-bottom: 5px;
        }
        .track-artist {
            font-size: 18px; color: #aaa;
        }
        .progress-bar {
            width: 100%; height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px; margin-top: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #1db954;
            border-radius: 3px;
            transition: width 0.5s linear;
        }
        #queue-container {
            position: absolute; bottom: 250px; left: 50%;
            transform: translateX(-50%);
            width: 800px; max-height: 300px;
            overflow: hidden;
        }
        .queue-item {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slide-in 0.3s ease-out;
        }
        .queue-number {
            font-size: 20px; font-weight: bold;
            color: #1db954; width: 30px;
        }
        .queue-track {
            flex: 1;
        }
        .queue-name {
            font-size: 16px; color: white;
            font-weight: 600;
        }
        .queue-artist {
            font-size: 14px; color: #aaa;
        }
        .requested-by {
            font-size: 12px; color: #666;
            font-style: italic;
        }
        @keyframes slide-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #connection-status {
            position: fixed; top: 10px; right: 10px;
            padding: 8px 16px; background: rgba(0, 0, 0, 0.7);
            color: white; border-radius: 20px;
            font-size: 12px; font-family: monospace; z-index: 10000;
        }
        #connection-status.connected { background: rgba(0, 200, 0, 0.7); }
    </style>
</head>
<body>
    <div id="connection-status">Connecting...</div>
    <div id="now-playing" style="display: none;">
        <div class="now-playing-header">ðŸŽµ NOW PLAYING</div>
        <div class="track-info">
            <img id="album-art" class="album-art" src="" alt="Album Art">
            <div class="track-details">
                <div class="track-name" id="track-name">-</div>
                <div class="track-artist" id="track-artist">-</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
    </div>
    <div id="queue-container"></div>
    <script>
        const OVERLAY_SERVER_URL = 'wss://your-overlay-server.onrender.com';
        const WS_PATH = '/ws/songrequests';
        let ws = null;
        const statusEl = document.getElementById('connection-status');
        const nowPlayingEl = document.getElementById('now-playing');
        const queueContainer = document.getElementById('queue-container');
        let currentTrack = null, queue = [];
        function connect() {
            ws = new WebSocket(OVERLAY_SERVER_URL + WS_PATH);
            ws.onopen = () => {
                console.log('âœ… Connected'); statusEl.textContent = 'Connected';
                statusEl.className = 'connected';
            };
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'song_request_data' || data.type === 'initial-state') {
                    const state = data.state || data;
                    if (state.currentTrack) updateNowPlaying(state.currentTrack);
                    if (state.requests) updateQueue(state.requests);
                    if (state.spotifyQueue) updateQueue(state.spotifyQueue);
                } else if (data.type === 'song_request') {
                    addToQueue(data.request);
                } else if (data.type === 'spotify_update') {
                    if (data.currentTrack) updateNowPlaying(data.currentTrack);
                    if (data.spotifyQueue) updateQueue(data.spotifyQueue);
                }
            };
            ws.onclose = () => { setTimeout(connect, 3000); };
        }
        function updateNowPlaying(track) {
            currentTrack = track;
            if (track && track.title) {
                nowPlayingEl.style.display = 'block';
                document.getElementById('track-name').textContent = track.title || track.name;
                document.getElementById('track-artist').textContent = track.artist || track.artists;
                document.getElementById('album-art').src = track.albumArtwork || track.image || '';
                const progress = track.progress && track.duration ? (track.progress / track.duration) * 100 : 0;
                document.getElementById('progress-fill').style.width = progress + '%';
            } else {
                nowPlayingEl.style.display = 'none';
            }
        }
        function updateQueue(requests) {
            queue = requests;
            queueContainer.innerHTML = '';
            requests.slice(0, 5).forEach((req, index) => {
                const item = document.createElement('div');
                item.className = 'queue-item';
                item.innerHTML = `
                    <div class="queue-number">${index + 1}</div>
                    <div class="queue-track">
                        <div class="queue-name">${req.songTitle || req.title || req.name || 'Unknown'}</div>
                        <div class="queue-artist">${req.artist || req.artists || 'Unknown Artist'}</div>
                        ${req.username ? `<div class="requested-by">Requested by ${req.username}</div>` : ''}
                    </div>
                `;
                queueContainer.appendChild(item);
            });
        }
        function addToQueue(request) {
            queue.push(request);
            updateQueue(queue);
        }
        connect();
        setTimeout(() => { if (statusEl.className === 'connected') statusEl.style.opacity = '0.3'; }, 5000);
    </script>
</body>
</html>

